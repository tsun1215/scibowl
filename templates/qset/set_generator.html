{%extends 'base.html'%}

{%block head%}
<script src="/static/js/jquery.js"></script>
<style>
    .question{
        font-family: "Times New Roman", Georgia, Serif;
    }
    .type{
        margin:20px 0;
    }
    .choices{
        margin:1em 0;
    }
    .q_id{
        display:none;
    }
    #content-container{
        margin-top:60px;
    }
</style>
<script>
    var template = "\
    <div class='question'> \
        <span class='q_id'></span> \
        <center class='type'></center> \
        <div class='qbody'> \
            <span class='num'></span> \
            <strong class='subject'></strong> \
            <em class='sub_type'></em> \
            <span class='text'></span> \
            <div class='choices'></div> \
            <span class='answer'></span> \
        </div> \
    </div>";
    var subjects = "{{subjects}}";
    var toss_up_round = Boolean("{{toss_up_round}}");
    $(document).ready(function(){
        $.get("/getall/?all=true&random=true&num={{num}}&subject={{subjects}}", function(data){
            var container = $("#question-container");
            for(var x=0; x<data.length; x++){
                var question = data[x];
                container.append(template);
                if(toss_up_round){
                    $('.question .type').last().text("TOSS-UP");
                }else{
                    $('.question .type').last().text((x%2==0)?"TOSS-UP":"BONUS");                    
                }
                $('.question .num').last().text((x+1)+".");
                $('.question .subject').last().text(question.subject);
                $('.question .sub_type').last().text((question.type==0)?"Multiple Choice":"Short Answer");
                if(question.type == 0){
                    var choices = $(".question .choices").last();
                    choices.append("W) "+question.w+"<br/>");
                    choices.append("X) "+question.x+"<br/>");
                    choices.append("Y) "+question.y+"<br/>");
                    choices.append("Z) "+question.z+"<br/>");
                }
                $('.question .text').last().html(question.text);
                $('.question .answer').last().html("ANSWER: "+question.answer);
                $('.question .q_id').last().text(question.id);
            }
        });
        $("#finalize").submit(function(){
            questions = [];
            var data = $(".question");
            for(var x = 0; x<data.length; x++){
                var id = $(data[x]).children('.q_id').text();
                var type = ($($(data[x]).children('.type')).text()=="BONUS")?1:0;
                questions.push({id:id,type:type,q_num:(x+1)});
            }
            $("#questions").val(JSON.stringify(questions));
        });
    });
</script>
{%endblock%}

{%block content%}
    <div id="question-container">
    </div>
    <form id="finalize" method="post" action="/set/finalize/">
        <input type="hidden" id="questions" name="questions"/>
        <input type="hidden" name="set_id" value="{{set.id}}"/>
        <input type="submit" value="Submit"/>
    </form>
{%endblock%}